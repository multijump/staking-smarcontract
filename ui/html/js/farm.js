"use strict";function _slicedToArray(n,a){return _arrayWithHoles(n)||_iterableToArrayLimit(n,a)||_unsupportedIterableToArray(n,a)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(n,a){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(n)){var t=[],e=!0,o=!1,r=void 0;try{for(var i,d=n[Symbol.iterator]();!(e=(i=d.next()).done)&&(t.push(i.value),!a||t.length!==a);e=!0);}catch(n){o=!0,r=n}finally{try{e||null==d.return||d.return()}finally{if(o)throw r}}return t}}function _arrayWithHoles(n){if(Array.isArray(n))return n}function _toConsumableArray(n){return _arrayWithoutHoles(n)||_iterableToArray(n)||_unsupportedIterableToArray(n)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(n,a){if(n){if("string"==typeof n)return _arrayLikeToArray(n,a);var t=Object.prototype.toString.call(n).slice(8,-1);return"Object"===t&&n.constructor&&(t=n.constructor.name),"Map"===t||"Set"===t?Array.from(n):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(n,a):void 0}}function _iterableToArray(n){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(n))return Array.from(n)}function _arrayWithoutHoles(n){if(Array.isArray(n))return _arrayLikeToArray(n)}function _arrayLikeToArray(n,a){(null==a||a>n.length)&&(a=n.length);for(var t=0,e=new Array(a);t<a;t++)e[t]=n[t];return e}var BSC=56,NETWORK=1,pairList=[],sortField="",sortDirection="";function initHook(){window.hooks.forEach(createHook)}function initFarm(){console.log("initFarm"),initData(function(a){a=a.filter(function(n){return 0<n.maxStake}),console.log(a);var n=window.variables,e=n.NETWORK,t=n.CONTRACT_ERC20_ABI;Promise.all(a.map(function(n){var a=new web3.eth.Contract(t,toChecksumAddress(n.token));return Promise.all([Promise.resolve(n.token),call(a.methods.name)(),call(a.methods.decimals)(),call(a.methods.symbol)()])})).then(function(n){var t=n.map(function(n){return{address:n[0],decimals:n[2],logoURI:null,name:n[1],symbol:n[3]}});(window.variables.TOKEN_LIST[e]=t).map(function(n){window.variables.PAIR_TOKEN_CONTRACTS[toChecksumAddress(n.address)]=new web3.eth.Contract(window.variables.CONTRACT_ERC20_ABI,toChecksumAddress(n.address))}),window.variables.farm.POOLS=a.filter(function(a){return!!t.find(function(n){return toChecksumAddress(n.address)===toChecksumAddress(a.token)})}),window.variables.farm.USERS=[],window.variables.farm.ALLOWANCES=[],updateFarm(),refreshFarm()}).catch(function(n){console.log("===---=== ",n)})})}function updateFarm(){window.variables.farm.POOLS&&initUserData(function(){farmTableRender()})}function refreshFarm(){setTimeout(function(){updateFarm(),refreshFarm()},3e4)}function onNetworkChanged(){$("#farm-table-body .farm-item").remove(),$("#loading").show(),$("#no-pools").hide()}function initData(t){console.log(window.variables),window.variables.FACTORY_CONTRACT&&Promise.all([getPools()]).then(function(n){var a=_slicedToArray(n,1)[0];t(a)}).catch(console.log)}function initUserData(o){var n=window.variables,a=n.ACCOUNT,t=n.farm.POOLS;a&&Promise.all([a?getPoolUser(a):Promise.resolve([]),a&&t?getAllowances(a,t):Promise.resolve([])]).then(function(n){var a=_slicedToArray(n,2),t=a[0],e=a[1];console.log("allowances : ",e),console.log("users : ",t),window.variables.farm.USERS=t,window.variables.farm.ALLOWANCES=e,o()}).catch(console.log)}function farmTableRender(){var w=window.variables.farm.USERS||[],k=window.variables.farm.ALLOWANCES||[],g=window.variables.TOKEN_LIST[window.variables.NETWORK||NETWORK],n=window.variables.farm.POOLS;0<n.length?($("#farm-table-body .farm-item").remove(),n.forEach(function(a){var n,t,e,o=g.find(function(n){return n.address.toLowerCase()==a.token}),r="".concat(o.name),i="".concat(o.symbol),d=(a.balance,k[a.token]&&k[a.token].reward?k[a.token].reward:"0.00"),c=!k[a.token]||k[a.token]&&!k[a.token].reward?"No rewards":"Harvest Now",s="",l="";s=(!k[a.token]||k[a.token]&&!k[a.token].allowance)&&new BigNumber(a?((null==a?void 0:a.balance)||0)/1e18:"0.00").isZero()?'<a class="btn btn-link btn-approve-staking" href="#" data-address="'.concat(a.token,'" data-name="').concat(i,'">Approve Staking</a>'):'<a class="btn btn-link js-popup-open"\n                        href="#stake_asset"\n                        data-id="'.concat(a.id,'"\n                        data-address="').concat(a.token,'"\n                        data-name="').concat(i,'"\n                        data-type="stake"\n                        data-amount="').concat(k[a.token].balance,'"\n                        data-max-amount="').concat(a.maxStake,'"\n                        data-current-staked="').concat(new BigNumber(w?((null===(t=w[a.id])||void 0===t?void 0:t.amount)||0)/1e18:0),'"\n                        data-title="Deposit">Stake</a>'),new BigNumber(w?((null===(n=w[a.id])||void 0===n?void 0:n.amount)||0)/1e18:0).isZero()||(l='<a class="btn btn-link js-popup-open"\n                          href="#stake_asset"\n                          data-id="'.concat(a.id,'"\n                          data-address="').concat(a.token,'"\n                          data-name="').concat(i,'"\n                          data-type="unstake"\n                          data-amount="').concat(new BigNumber(null===(e=w[a.id])||void 0===e?void 0:e.amount).div(1e18).toString(10)||0,'"\n                          data-title="Withdraw">UnStake</a>'));var u,m,f,v,p,b=$("#farm-table-body").find("#pair-".concat(i));b.length?(b.find("#pair-".concat(i,"-earned-title")).text("".concat(formatNumber(d)," SHARD")),b.find("#pair-".concat(i,"-earned-desc")).empty(),!k[a.token]||k[a.token]&&!k[a.token].reward?(b.find("#pair-".concat(i,"-earned-desc")).text("".concat(c)),b.find("#pair-".concat(i,"-earned-desc")).removeClass("earn-descr").addClass("descr")):(b.find("#pair-".concat(i,"-earned-desc")).removeClass("descr").addClass("earn-descr"),b.find("#pair-".concat(i,"-earned-desc")).append('\n            <a class="btn btn-lbiege btn-harvest-now" href="#" data-id="'.concat(a.id,'">').concat(c,"</a>\n          "))),b.find("#pair-".concat(i,"-actions")).empty(),b.find("#pair-".concat(i,"-actions")).append("\n          ".concat(s,"\n          ").concat(l,"\n        "))):(f="",f=!k[a.token]||k[a.token]&&!k[a.token].reward?'\n            <div id="pair-'.concat(i,'-earned-desc" class="descr">\n              ').concat(c,"\n            </div>\n          "):'\n            <div id="pair-'.concat(i,'-earned-desc" class="earn-descr">\n              <a class="btn btn-lbiege btn-harvest-now" href="#" data-id="').concat(a.id,'">').concat(c,"</a>\n            </div>\n          "),v='<td id="pair-'.concat(i,'-actions" class="td-btns"></td>'),window.variables.NETWORK&&(v='<td id="pair-'.concat(i,'-actions" class="td-btns">\n            ').concat(s,"\n            ").concat(l,"\n          </td>")),p=(null===(u=g.find(function(n){return toChecksumAddress(n.address)===toChecksumAddress(a.token)}))||void 0===u?void 0:u.logoURI)||"images/defaultAsset.svg",$("#loading").hide(),$("#no-pools").hide(),$("#farm-table-body").append('\n          <tr id="pair-'.concat(i,'" class="farm-item">\n            <td>\n              <div class="cell-title">Farm : </div>\n              <div class="cell-farms">\n                <div class="cell-farms__icons">\n                  <div class="first-icon">\n                    <img src="').concat(p,'" alt="').concat(i,'">\n                  </div>\n                </div>\n                <div class="cell-farms__text">\n                  <p>').concat(r,'</p>\n                  <div class="descr">').concat(i,'</div>\n                </div>\n              </div>\n            </td>\n            <td>\n              <div class="cell-title">Yield(per $1,000) : </div>\n              <div class="cell-yield">\n                <div class="cell-yield__text">\n                  <p>').concat(formatNumber(a.secondaryTokensPerDay/1e18,2),' SHARD/Day</p>\n                </div>\n              </div>\n            </td>\n            <td class="').concat(0<=100*a.roiPerYear?"td-apy-raised":"td-apy-down",'">\n              <div class="cell-title">APY : </div>\n              <div class="td-apy-raised--value">\n                <span>').concat(a.maxStake/1e18," ").concat(i,'</span>\n              </div>\n            </td>\n            <td class="farm-liquidity">\n              <div class="cell-title">Liquidity : </div>\n              <div class="farm-liquidity-value">\n                ').concat(new BigNumber(w?((null===(m=w[a.id])||void 0===m?void 0:m.amount)||0)/1e18:"0.00"),"  ").concat(i,'\n              </div>\n            </td>\n            <td>\n              <div class="cell-title">Earned : </div>\n              <div class="cell-earned">\n                <div class="cell-earned__text">\n                  <p id="pair-').concat(i,'-earned-title" data-value="').concat(d,'">').concat(formatNumber(d)," SHARD</p>\n                  ").concat(f,"\n                </div>\n              </div>\n            </td>\n            ").concat(v,"\n          </tr>\n        ")))})):($("#loading").hide(),$("#no-pools").show())}function harvestNow(n,a){runHarvest([n,a],function(n,a){a&&console.log(a)})}function approveStaking(n,a){runApproveStaking(n,a,function(n,a){a&&console.log(a)})}function onStake(n){var a=$(document.forms.stake),t=new BigNumber(a.find("input#available_amount").val()),e=new BigNumber(a.find("a.js-input-max-balance").attr("data-value")),o=a.find("#current_stake_type").val(),r=a.find("#current_pool_id").val(),i=a.find("#current_pool_pair_name").val(),d=a.find("#current_pool_pair_max").val(),c=a.find("#current_pool_pair_current").val(),s=new BigNumber(d/1e18).minus(c);t.gt(new BigNumber(0))&&t.lte(e)&&t.lte(s)&&r&&"stake"===o||t.gt(new BigNumber(0))&&t.lte(e)&&r&&"unstake"===o?runStake(r,t.toString(10),i,o,function(n,a){a&&console.log(a)}):"stake"===o?s.isZero()?a.find("#stake_asset_alert").text("Exceed max stake amount. You cannot stake anymore."):t.gt(s)&&s.lte(e)?a.find("#stake_asset_alert").text("Exceed max stake amount. You can stake only ".concat(s.toString(10)," ").concat(i," now.")):t.gt(e)&&s.gt(e)&&a.find("#stake_asset_alert").text("Exceed max stake amount. You can stake only ".concat(e.toString(10)," ").concat(i," now.")):a.find("#stake_asset_alert").text("Exceed unstake amount. You can unstake only ".concat(e.toString(10)," ").concat(i," now."))}function onStakeMaxAmount(n){var a,t,e,o=$(document.forms.stake),r=o.find("#current_stake_type").val(),i=new BigNumber(o.find("a.js-input-max-balance").attr("data-value"));o.find("#stake_asset_alert").text(""),"stake"===r?(a=o.find("#current_pool_pair_max").val(),t=o.find("#current_pool_pair_current").val(),e=new BigNumber(a/1e18).minus(t),i.gt(e)?o.find("input#available_amount").val(e.dp(18,1).toString(10)):o.find("input#available_amount").val(i.dp(18,1).toString(10))):o.find("input#available_amount").val(i.dp(18,1).toString(10))}function onStakeInput(n){var a=$(document.forms.stake);a.find("#stake_asset_alert").text("");var t=new BigNumber(a.find("a.js-input-max-balance").attr("data-value"));new BigNumber(n.target.value).gt(t)?$(a).find(".js-confirm-btn").prop("disabled",!0):$(a).find(".js-confirm-btn").prop("disabled",!1)}function isNumber(n){return"number"==typeof n&&isFinite(n)}window.onload=function(){console.log("onLoad!"),window.events.initHook=initHook,window.triggers.onLoad=[].concat(_toConsumableArray(window.triggers.onLoad||[]),["initHook"]),window.variables.farm={},window.triggers.networkChanged=[].concat(_toConsumableArray(window.triggers.networkChanged||[]),["onNetworkChanged"]),window.events.initFarm=initFarm,window.triggers.selectAccount=[].concat(_toConsumableArray(window.triggers.selectAccount||[]),["initFarm"]),window.events.onNetworkChanged=onNetworkChanged,window.events.onStakeMaxAmount=onStakeMaxAmount,window.events.onStakeInput=onStakeInput,window.events.onStake=onStake,$(document).on("click",".btn-harvest-now",function(n){n.preventDefault(),harvestNow($(this).attr("data-id"),$(this).closest(".cell-earned__text").find("p").attr("data-value"))}),$(document).on("click",".btn-approve-staking",function(n){n.preventDefault(),approveStaking($(this).attr("data-address"),$(this).attr("data-name"))}),$(document).on("click",".farm-table-header-apy",function(n){n.preventDefault(),onSort("apy")}),$(document).on("click",".farm-table-header-liquidity",function(n){n.preventDefault(),onSort("liquidity")}),$(document).on("click",".farm-table-header-staked",function(n){n.preventDefault(),onSort("staked")}),initFarm()};